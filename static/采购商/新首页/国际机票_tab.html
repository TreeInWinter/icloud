<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
 <link rel="stylesheet" href="/static/css/smoothness/jquery-ui-1.10.3.custom.css" />
    <link rel="stylesheet" href="/static/css/store_reset.css" />
    <link rel="stylesheet" href="/static/css/kendo.common.min.css" />
    <link rel="stylesheet" href="/static/css/kendo.store.css" />
    <link rel="stylesheet" href="/static/css/toolkit.css" />
        <link rel="stylesheet" href="/static/css/tmp/querytab.css">

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/kendo.web.js"></script>
    <script type="text/javascript" src="/static/js/global.js"></script>


<script type="text/javascript" src="/static/js/swfup/swfupload.js"></script>
<script type="text/javascript" src="/static/js/swfup/swfupload.queue.js"></script>
<script type="text/javascript" src="/static/js/swfup/fileprogress_cgs.js"></script>
<!--[if IE]>
<script src="../static/js/html5.js"></script>
<![endif]-->

    </head>
    <body>
        <section class="querytab querytab-international">
            <div class="querytab-wrapper col clearfix">
            <aside class="querytab-controller">
            <ul>
                <li><b data-role="ctype" data-index="1" data-group="qtab" class="current"> 机票预定</b></li>
                <li><b data-role="ctype" data-index="2" data-group="qtab">PNR导入</b></li>
                <li><b>询价单</b></li>
            </ul>
            </aside>
            <div class="querytab-content col">
                <div class="querytab-flight" data-role="ctype-item" data-index="1" data-group="qtab">
                        <ul>
                            <li class="trip_type gap">
                            <strong>航程类型</strong>
                            <label><input type="radio" data-role="ctype" data-group="trip_type" data-index="c1" name="flight_type" checked/><span>单程</span></label>
                            <label><input type="radio" class="isDouble" data-role="ctype" data-group="trip_type" data-index="c1" name="flight_type" /><span>往返</span></label>
                            <label><input type="radio" data-role="ctype" data-group="trip_type" data-index="c2" name="flight_type" /><span>多程(含缺口)</span></label>
                            <span class="text1" style="display:none;" data-role="ctype-item" data-group="trip_type" data-index="c2"> 超过6段航程,请联系机票专家组。 <b class="tel">400-720-6666</b></span>
                            </li>
                            <li class="round_trip clearfix">
                            <div  class="single_trip" data-role="ctype-item" data-index="c1" data-group="trip_type">
                            <b class="xchange">换</b>
                            <table>
                                <colgroup>
                                    <col class="col1">
                                    <col class="col2">
                                    </colgroup>
                                <tr>
                                    <td>
                                    <label><span class="text">出发城市</span><input style="width:145px;" class="city_ac" type="text" name="" /></label>
                                    </td>
                                    <td>
                                    <label><span class="text">出发日期</span><input style="width:145px;" placeholder="yyyy-mm-dd" type="text" name="" class="datepicker" /></label>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                    <label><span class="text">到达城市</span><input style="width:145px;" class="city_ac" type="text" name="" /></label>
                                    </td>
                                    <td>
                                    <label class="return_date disabled"><span class="text">返程日期</span><input type="text" disabled name="" placeholder="yyyy-mm-dd" style="width:145px;" class="datepicker" /></label>
                                    </td>
                                </tr>
                            </table>
                            </div>
                            <div class="muti_trip" data-role="ctype-item" data-index="c2" style="display:none;" data-group="trip_type">
                                <script type="text/x-kendo-template" id="ac-add-line-template">
<tr>
                                        <td><span class="hitext index_num">1</span></td>
                                        <td>出发城市</td>
                                        <td><input type="text" style="width:145px;" value="" class="city_ac"/></td>
                                        <td>到达城市</td>
                                        <td><input type="text" style="width:145px;" value="" class="city_ac"/></td>
                                        <td>出发日期</td>
                                        <td><input type="text" value="" placeholder="yyyy-mm-dd" class="datepicker"/></td>
                                        <td>
                                            <div class="op">
                                                <b class="ac-remove-line">删除</b>
                                            </div>
                                        </td>
                                    </tr>
                                </script>
                                <table>
                                    <colgroup>
                                        <col class="col1">
                                        <col class="col2">
                                        <col class="col3">
                                        <col class="col4">
                                        <col class="col5">
                                        <col class="col6">
                                        <col class="col7">
                                        <col class="col8">
                                        </colgroup>
                                    <tbody>
                                    <tr>
                                        <td><span class="hitext index_num">1</span></td>
                                        <td>出发城市</td>
                                        <td><input type="text" value="" style="width:145px" class="city_ac"/></td>
                                        <td>到达城市</td>
                                        <td><input type="text" value="" style="width:145px" class="city_ac"/></td>
                                        <td>出发日期</td>
                                        <td><input type="text" value="" placeholder="yyyy-mm-dd" class="datepicker"/></td>
                                        <td>
                                            <div class="op">
                                                <!--<b class="ac-remove-line">删除</b> -->
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><span class="hitext index_num">2</span></td>
                                        <td>出发城市</td>
                                        <td><input type="text" value="" style="width:145px" class="city_ac"/></td>
                                        <td>到达城市</td>
                                        <td><input type="text" value="" style="width:145px" class="city_ac"/></td>
                                        <td>出发日期</td>
                                        <td><input type="text" value="" placeholder="yyyy-mm-dd" class="datepicker"/></td>
                                        <td>
                                            <div class="op">
                                                <!-- <b class="ac-remove-line">删除</b> -->
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="row-add-line">
                                    <b class="muti_add ac-add-line"><i class="icon icon-plus"></i>添加航程</b>
                                    </div>
                            </div>

                            <h4 class="underline-title"><span><i class="icon icon-arrows"></i>高级搜索</span></h4>
                            <table class="advanced_search clearfix">
                                <colgroup>
                                    <col class="col1">
                                    <col class="col2">
                                    </colgroup>
                                <tr>
                                    <td>
                                    <label><span class="text">舱位等级</span><select data-role="dropdownlist" style="width:145px;">
                                            <option selected="" value="经济舱">经济舱</option>
                                            <option value="超级经济舱">超级经济舱</option>
                                            <option value="商务舱">商务舱</option>
                                            <option value="头等舱">头等舱</option>
                                        </select>
                                    </label>
                                    </td>
                                        <td>
                                    <label><span class="text">航空公司</span><input style="width:145px;" data-role="combobox" data-filter="contains" data-suggest="true" placeholder="编号/中文" data-text-field="text" data-value-field="value"  data-source='[{ text: "南航", value: "8U" }, { text: "国航", value: "BK" }]' class="sel_airlines" />

                                        </label>

                                </td>
                                </tr>
                                <tr>
                                    <td>
                                    <label><span class="text">乘客类型</span><select data-role="dropdownlist" style="width:145px;">
                                            <option selected="" value="成人">成人</option>
                                            <option value="儿童">儿童</option>
                                            <option value="婴儿">婴儿</option>
                                            <option value="不限">不限</option>
                                        </select>
                                    </label>
                                    </td>
                                    <td>
                                    <label class="sail_type"><input type="radio" checked="" name="type" />全部</label>
                                    <label class="sail_type"><input type="radio" name="type"/>直飞</label>
                                    <label class="sail_type"><input type="radio" name="type"/>中转</label>
                                    </td>
                                </tr>
                            </table>
                            </li>
                        </ul>

                            <div class="btn_area">
                                <button type="button" class="btn btn-c1 btn-s1">搜  索</button>
                            </div>
                </div>

                <div class="querytab-pnr" data-role="ctype-item" data-index="2" data-group="qtab" style="display:none;">
                    <ul class="black_booking">
                        <li class="passenger gap">
                        <span class="subline">乘客类型</span>
                        <label><input type="radio" data-role="ctype" data-group="passenger_type" name="passenger_type" value="adult" checked/><span>成人</span></label>
                        <label><input type="radio" data-role="ctype" data-group="passenger_type" data-index="c1" name="passenger_type" value="child"/><span>儿童</span></label>
                        <label><input type="radio" data-role="ctype" data-group="passenger_type" name="passenger_type" data-index="c3" value="student"/><span>学生</span></label>
                        <label><input type="radio" data-role="ctype" data-group="passenger_type" name="passenger_type" value="team"/><span>团队</span></label>
                        <label>
                            <input type="radio" data-role="ctype" data-group="passenger_type" data-index="c2" name="passenger_type" value="others" /><span>其他类型</span>
                        </label>
                        <select data-role="dropdownlist" style="width:80px;" name="other">
                            <option value="青年">青年</option>
                            <option value="老人">老人</option>
                            <option value="移民" selected="selected">移民</option>
                            <option value="海员">海员</option>
                            <option value="劳务">劳务</option>
                        </select>

                        </li>

                        <li class="passenger gap clearfix" data-role="ctype-item" data-group="passenger_type" data-index="c2 c3" style="display:none;">
                        <span class="subline">上传证件</span>

                        <a class="upload-button" href="javascript:;"><span id="UploaderPlaceholder_1"></span></a>
                        <span allowSize="1000mb" allowFile="*.jpg;*.jpeg;*.png;*.iso" class="Uploader fl-uploader">该乘客类型需传证明文件，支持上传多个</span>

                        <div class="uploader-wrapper">
                            <div class="uploader-inner">
                        <div class="fl-uploader-error">上传文件失败，请重新上传（失败原因<i class='fl-error'>&#12288;
                                <div class="fl-uploader-wrap message_ct">
                                    <div class="arrow arrow_north"></div>
                                    <div class="message_text fl-uploader-errfiles"></div>
                        </div></i>）</div>
                        <div class="fl-upholder" id="UploaderProgress_1"></div>
                        </div>
                    </div>



                        </li>

                        <li class="passenger gap" id="child_extra" data-role="ctype-item" data-group="passenger_type" data-index="c1" style="display:none;">
                        <span class="subline">成人票号</span>
                        <label><input type="text" style="width:128px"/></label><span class="text3">请确认儿童有成人陪伴，提供成人票号。如是无成人陪伴儿童，请向航空公司申请。</span>
                        </li>
                        <li class="ways clearfix">
                        <div class="col">
                        <p class="way-console">
                            <span class="subline">导入PNR</span>
                            <input type="text" placeholder="请输入6位PNR编码" class="input-pnr">
                            <span class="invalid-text">PNR和黑屏必须填写一个</span>
                        </p>
                        <textarea class="black-paste">
使用方法:
1. 请使用您的Eterm系统提取PNR内容。
2. 请确保导入的PNR中所含的航段是通过正常途径获得，任何通过非法手段获取低舱位的PNR，若导致产生ADM单，将由采购商承担。</textarea>
                        <div class="btn_area">
                              <button type="button" class="btn btn-c1 btn-s1">创建订单</button>
                        </div>
                        </div>
                    <div class="col pnr-notes">
                        <strong class="text2">注意事项：</strong>
<ol>
    <li>请确认您的PNR信息不包含共享航班，由于共享航班问题产生的纠纷本平台概不负责。请确保导入旅客API信息准确无误。</li>
    <li>请勿在订票系统无任何可销售的低舱位或航班超售的情况下，通过违规手段获取航空公司的低舱位，如因此产生的所有损失和赔偿，由采购方承担。平台不承担任何责任。</li>
    <li>仅适用Eterm编码，PNR支持HK、RR、TK、KK状态。</li>
    <li>请授权给SHA255，授权指令：RMK TJ AUTH OFFCIE,例如：RMK TJ AUTH SHA255。</li>
</ol>
                    </div>



                        </li>
                    </ul>
                </div>
                <div class="querytab-sheet"></div>
            </div>
            </div>
        </section>

<script type="text/x-kendo-template" id="city_popup">
<div id="gn-tabstrip" class="tcy_tabstrip">
<span class="tcy_title">
    热门城市/国家（支持中文名/拼音/英文名/三字码）
</span>
<ul>
<li id="hot_city" class="k-state-active">热门</li>
# for (var i=0; i<data.group.length; i++ ) { #
<li>#= data.group[i] #</li>
# } #
</ul>
<div id="hot_city_tab">
<ul class="tcy_list clearfix">

# for(var j=0;j<hotcitylist.length;j++){ #
# var citylist_item = hotcitylist[j] #
<li class="item" title="#= citylist_item.code #" data-code="#= citylist_item.code #">#= citylist_item.name #</li>
# } #
</ul>
</div>

# for(var i=0;i<data.citylist.length;i++){ #
# var citylist_item = data.citylist[i] #
<div class="city_tab">
<ul class="tcy_list clearfix">
  # for(var k=0;k<data.group[i].length;k++){ #
    <li class="tcy_list_sep">#= data.group[i].split('')[k] #</li>
    # for(var j=0;j<citylist_item.value.length;j++){ #
        # var citylist_value_item = citylist_item.value[j]; #
        # if(citylist_value_item.py.slice(0,1) == data.group[i].split('')[k]) {#
            <li class="item" title="#= citylist_value_item.code #" data-code="#= citylist_value_item.code #">#= citylist_value_item.name #</li>
        # } #
    # } #
  # } #
</ul>
</div>

# } #
</div>
</script>



<script>
function createSwfUpload(index,allowSize, allowFile){
    var upload = window.swfu = new SWFUpload({
	// Backend Settings
	upload_url: "/php/upload.php",
	post_params: {"name" : "testname"},
	// File Upload Settings
	//file_types : "*.*;",
	file_size_limit : allowSize ,
	file_types : allowFile ,
	file_types_description : "Choose Files",
	file_upload_limit : "0",
	file_queue_limit : "0",
	// Event Handler Settings (all my handlers are in the Handler.js file)
	file_dialog_start_handler : fileDialogStart,
	file_queued_handler : fileQueued,
	file_queue_error_handler : fileQueueError,
	file_dialog_complete_handler : fileDialogComplete,
	upload_start_handler : uploadStart,
	upload_progress_handler : uploadProgress,
	upload_error_handler : uploadError,
	upload_success_handler : uploadSuccess,
	upload_complete_handler : uploadComplete,
	// Button Settingsimg/fee
   // button_image_url : "/static/images/button_3_3_5.png",
	button_text : '<span class="text">上 传</span>',
	button_text_style : ".text{text-align:center;font-size:13px;}",
	button_text_top_padding: 5,

	button_placeholder_id : "UploaderPlaceholder_" + index,
	button_width: 55,
	button_height: 26,
	button_window_mode:"TRANSPARENT",
	button_cursor: SWFUpload.CURSOR.HAND,
	// Flash Settings
	flash_url : "/static/flash/swfupload.swf",
	custom_settings : {
		progressTarget : "UploaderProgress_" + index,
		cancelButtonId : "UploaderCancelBtn_" + index,
		callback : function(file,serverData){
            var tmp = $.parseJSON(serverData);
		}
	},

	// Debug Settings
	debug: false
    });

    return upload;
}

var uploads = [];

$(function(){
    $.role_ctype({
        changeClass:'current'
    });

    $('.input-pnr').on('blur',function(){
        $(this).addClass('invalid');
        $('.invalid-text').show();
    });

    $('.black-paste').on('focus',function(){
        $('.uploader-wrapper').hide();
    });

    $('.querytab').on('click','.uploadComplete .progressCancel',function(){
         $(this).closest('.progressWrapper').remove();
    });

    $('.querytab').on('click','.progressCancel',function(){
         if($('.querytab .progressWrapper').length<1){
                $('.uploader-wrapper').hide();
         }
    });

    $(".Uploader").each(function(index){
        uploads.push(createSwfUpload(index + 1,$(this).attr("allowSize"),$(this).attr("allowFile")));
    });

    $('body').on('click','.fl-complete .progressCancel',function(){
        $(this).closest('.progressWrapper').remove();
    });

    $('.top_title input').on('change',function(){
        var li = $(this).closest('li');
        li.addClass('selected');
        li.siblings().removeClass('selected');
    });

    var uploadsettings = {
        multiple:false,
        showFileList:false,
        select:function(e){
            e.sender.wrapper.prev().val(e.files[0].name);
        },
        complete:function(e){
            var url = e;
        },
        async: {
            saveUrl: "/path/to/save.jsp",
            //saveUrl: 'http://www.tz-local.com/test.php',
            autoUpload: true
        },
        localization:{
            select: '浏览'
        }
    };

    kendo.culture('zh-CN');

    $('.ac-add-line').bind('click',function(){
        var container = $('.muti_trip tbody');
        var html = kendo.template($('#ac-add-line-template').html())({});
        if(container.find('tr').length>5) return
        container.append(html);
        // kendo.init(container);
        // container.find('[type=file]').eq(-1).kendoUpload(uploadsettings)
        reorder();
        createCityAc(container.find('tr').last().find('.city_ac'));
    });

    $('body').delegate('.ac-remove-line','click',function(){
        var t = $(this);
        if (t.closest('table').find('tr').length <= 2){
            //return alert('只剩一条了');
            return;
        }
        t.closest('tr').remove();
        reorder();
    });

    function reorder(){
        $('.index_num').each(function(i){
            var t = $(this);
            t.text(i+1);
        });
    }

    function createCityAc(ele){
        CityAutocomplete({
            template: "#city_popup",
            input: ele,
            width: 200,
            // autocomplete:{
            //     dataSource:{
            //         transport:{
            //             read:{

            //             }
            //         }
            //     },
            //     placeholder:'三字吗/城市'
            // },
            // 以@分割热门非热门，以;分割条目，以|分割三字码拼音和中文
            url:'/static/js/data.txt',
            group: ["热门","GHJ", "ABCDEF", "KLMN", "PQSTW", "XYZ"]
        });
    }

    createCityAc(".city_ac");

    kendo.init('body');
    $('[type=file]').kendoUpload(uploadsettings)

    $('.trip_type [type=radio]').on('change',function(){
        var that = $(this);
        if(that.hasClass('isDouble') && that.is(':checked')){
            $('.return_date').removeClass('disabled');
            $('.return_date input').prop('disabled',false);
        }else{
            $('.return_date').addClass('disabled');
            $('.return_date input').prop('disabled',true);
        }
    });

});

</script>

    </body>
</html>
